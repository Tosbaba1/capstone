<% if @user.banner.present? %>
  <div class="profile-banner text-center py-3 mb-3">
    <h5 class="mb-0"><%= @user.banner %></h5>
  </div>
<% end %>

<div class="row align-items-center mb-4">
  <div class="col-auto">
    <%= image_tag(@user.avatar.presence || 'default_avatar.png', class: 'avatar rounded-circle', style: 'width:80px;height:80px;') %>
  </div>
  <div class="col">
    <div class="d-flex justify-content-between">
      <div>
        <h4 class="mb-0 text-white"><%= @user.name %></h4>
        <p class="mb-1 text-white">@<%= @user.username %></p>
        <% if @user.bio.present? %>
          <p class="mb-1 text-white"><%= @user.bio %></p>
        <% end %>
      </div>
      <div class="text-end text-white">
        <span class="me-3"><strong><%= @user.posts_count || 0 %></strong> Posts</span>
        <span class="me-3"><%= link_to "<strong>#{@user.followers.count}</strong> Followers".html_safe, followers_user_path(@user), class: 'text-white' %></span>
        <span><%= link_to "<strong>#{@user.following.count}</strong> Following".html_safe, following_user_path(@user), class: 'text-white' %></span>
      </div>
    </div>
    <% unless @user == current_user %>
      <% fr = current_user.sentfollowrequests.find_by(recipient: @user) %>
      <% if current_user.following.include?(@user) %>
        <%= button_to 'Unfollow', unfollow_user_path(@user), method: :delete, class: 'btn btn-secondary btn-sm mt-2' %>
      <% elsif fr&.status == 'pending' %>
        <span class="badge bg-secondary mt-2">Request Sent</span>
      <% else %>
        <%= button_to 'Follow', follow_user_path(@user), method: :post, class: 'btn btn-primary btn-sm mt-2' %>
      <% end %>
      <% if !@user.is_private || current_user.following.include?(@user) %>
        <%= link_to 'View Library', user_library_path(@user), class: 'btn btn-secondary btn-sm mt-2 ms-2' %>
      <% end %>
    <% else %>
      <%= link_to 'My Library', library_path, class: 'btn btn-secondary btn-sm mt-2' %>
    <% end %>
  </div>
</div>

<% if @restricted %>
  <p class="text-white">This account is private.</p>
<% end %>

<% @posts.each do |post| %>
  <div class="mb-3 p-3 border rounded content-box">
    <p class="mb-1"><strong><%= post.creator.name %></strong></p>
    <p class="mb-1"><%= post.content %></p>
    <div class="text-end">
      <%= link_to 'View Post', post_path(post), class: 'btn btn-sm btn-link text-white' %>
    </div>
    <small class="text-white"><%= time_ago_in_words(post.created_at) %> ago</small>
  </div>
<% end %>

<% if @posts.empty? %>
  <p class="text-white">No posts to display.</p>
<% end %>
